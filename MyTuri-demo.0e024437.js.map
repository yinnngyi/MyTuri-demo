{"mappings":"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","sources":["<anon>","src/js/main.js"],"sourcesContent":["(function() {\n    // Collapsible functionality\n    $('.card-header.clickable').on('click', function() {\n        const $card = $(this).closest('.collapsible');\n        const $content = $card.find('.card-content');\n        const $icon = $(this).find('.collapse-icon');\n        if ($card.hasClass('collapsed')) {\n            // Expand\n            $card.removeClass('collapsed').addClass('expanded');\n            $content.slideDown(300);\n            $icon.attr('data-lucide', 'chevron-up');\n        } else {\n            // Collapse\n            $card.removeClass('expanded').addClass('collapsed');\n            $content.slideUp(300);\n            $icon.attr('data-lucide', 'chevron-down');\n        }\n        // Recreate icons after changing data-lucide attribute\n        setTimeout(()=>{\n            lucide.createIcons();\n        }, 100);\n    });\n    /* ------------------------------------------------ */ const lessonData = {\n        \"greeting\": [\n            {\n                \"speaker\": \"Turi\",\n                \"text\": \"Welcome back. Today\\u2019s mission: spot linear functions fast \\u2014 no tricks, just clean reasoning. [TEST: The current sound is the test file...]\",\n                \"audio\": \"M1_Greet_1.mp3\"\n            },\n            {\n                \"speaker\": \"Turi\",\n                \"text\": \"Think of it like speed-dating with graphs \\u2014 you\\u2019ll know in seconds if it\\u2019s linear or not.\",\n                \"audio\": \"M1_Greet_2.mp3\"\n            },\n            {\n                \"speaker\": \"UnvoicedNote\",\n                \"text\": \"In live mode, Turi briefly checks goals and prior progress before starting.\"\n            },\n            {\n                \"speaker\": \"Turi\",\n                \"text\": \"You\\u2019ll see equations and graphs. Your job: decide if they\\u2019re linear and explain why.\",\n                \"audio\": \"M1_Greet_3.mp3\"\n            },\n            {\n                \"speaker\": \"UnvoicedNote\",\n                \"text\": \"In live mode, you\\u2019d answer by voice or typing; Turi asks for your reasoning before revealing anything.\",\n                \"audio\": \"M1_Greet_4.mp3\"\n            }\n        ],\n        \"concepts\": [\n            {\n                \"id\": \"A\",\n                \"image\": \"M1_CA.png\",\n                \"intro\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"First, the core idea: A line is linear if it has the same slope everywhere. [TEST: Skip the next three messages for TEST...]\",\n                        \"audio\": \"M1_CA_1.mp3\"\n                    },\n                    // {\n                    //   \"speaker\": \"Turi\",\n                    //   \"text\": \"In equations, that’s — one x, power of 1, nothing fancy. That one x tells us it’s a linear line.\"\n                    // },\n                    // {\n                    //   \"speaker\": \"Turi\",\n                    //   \"text\": \"On a graph, that’s a straight line with no curves and no surprises.\"\n                    // },\n                    // {\n                    //   \"speaker\": \"Turi\",\n                    //   \"text\": \"Try one. Pick the linear equation — I’ll ask “why” after.\"\n                    // },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, Turi will almost always ask why if the response is an answer without an educated reason. Turi will guide from the response.\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Which equation is linear?\",\n                        \"audio\": \"M1_CS1_Prompt.mp3\"\n                    }\n                ],\n                \"options\": [\n                    {\n                        \"label\": \"A\",\n                        \"text\": \"\\\\( y = m x + b \\\\)\",\n                        \"isCorrect\": true,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Exactly. One x, power of 1. That\\u2019s linear.\",\n                                    \"audio\": \"M1_CS1_A_C1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Spot on. It fits \",\n                                    \"audio\": \"M1_CS1_A_C2.mp3\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"B\",\n                        \"text\": \"\\\\( y = x^2 + 3x + 2 \\\\)\",\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Not linear.\",\n                                    \"audio\": \"M1_CS1_B_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Nope, quadratic means slope keeps changing.\",\n                                    \"audio\": \"M1_CS1_B_W2.mp3\"\n                                }\n                            ],\n                            \"note\": [\n                                {\n                                    \"speaker\": \"UnvoicedNote\",\n                                    \"text\": \"In live mode, Turi will plot a quadratic function to illustrate the point.\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"C\",\n                        \"text\": \"\\\\( y = -2x^2 + 4 \\\\)\",\n                        \"isCorrect\": false,\n                        \"feedback\": [\n                            {\n                                \"speaker\": \"Turi\",\n                                \"text\": \"Not quite. This has x squared, that\\u2019s quadratic.\",\n                                \"audio\": \"M1_CS1_B_C1.mp3\"\n                            },\n                            {\n                                \"speaker\": \"Turi\",\n                                \"text\": \"Look again. The squared x means it\\u2019s not linear.\",\n                                \"audio\": \"M1_CS1_B_C2.mp3\"\n                            },\n                            {\n                                \"speaker\": \"UnvoicedNote\",\n                                \"text\": \"\\u4E8C\\u6B21\\u65B9\\u7684 x\\uFF0C\\u4EE3\\u8868\\u9019\\u662F\\u4E8C\\u6B21\\u65B9\\u7A0B\\u5F0F\\uFF0C\\u4E0D\\u662F\\u7DDA\\u6027\\u3002\"\n                            }\n                        ]\n                    },\n                    {\n                        \"label\": \"D\",\n                        \"text\": \"The one that looks nicest.\",\n                        \"isCorrect\": false,\n                        \"feedback\": [\n                            {\n                                \"speaker\": \"Turi\",\n                                \"text\": \"Not quite. This has x squared, that\\u2019s quadratic.\",\n                                \"audio\": \"M1_CS1_B_C1.mp3\"\n                            },\n                            {\n                                \"speaker\": \"Turi\",\n                                \"text\": \"Look again. The squared x means it\\u2019s not linear.\",\n                                \"audio\": \"M1_CS1_B_C2.mp3\"\n                            },\n                            {\n                                \"speaker\": \"UnvoicedNote\",\n                                \"text\": \"\\u4E8C\\u6B21\\u65B9\\u7684 x\\uFF0C\\u4EE3\\u8868\\u9019\\u662F\\u4E8C\\u6B21\\u65B9\\u7A0B\\u5F0F\\uFF0C\\u4E0D\\u662F\\u7DDA\\u6027\\u3002\"\n                            }\n                        ]\n                    }\n                ],\n                \"reteach\": {\n                    \"speaker\": \"Turi\",\n                    \"text\": \"Linear means the same slope everywhere.\",\n                    \"audio\": \"M1_CS1_Reteach.mp3\"\n                },\n                \"reteach\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Linear means the same slope everywhere.\",\n                        \"audio\": \"M1_CS1_Reteach.mp3\"\n                    }\n                ],\n                \"redo\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Let\\u2019s try that again \\u2014 which equation is linear?\",\n                        \"audio\": \"M1_CS1_Redo.mp3\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, this re-ask would be open-ended, not multiple choice, and Turi would not advance until the correct answer is given.\"\n                    }\n                ]\n            }\n        ]\n    };\n    /* ------------------------------------------------ */ const $chatContainer = $('.chat-messages');\n    // speaker 轉換成 type\n    function mapSpeakerToType(speaker) {\n        if (speaker === 'Turi') return 'teacher';\n        if (speaker === 'UnvoicedNote') return 'unvoiced';\n        return 'unknown';\n    }\n    // 打字效果：逐字顯示文字\n    function typeText($element, text, speed = 50) {\n        return new Promise((resolve)=>{\n            let i = 0;\n            const interval = setInterval(()=>{\n                $element.text($element.text() + text.charAt(i));\n                i++;\n                if (i >= text.length) {\n                    clearInterval(interval);\n                    resolve();\n                }\n            }, speed);\n        });\n    }\n    // 播放音訊\n    function playAudio(src) {\n        return new Promise((resolve)=>{\n            const audio = new Audio(`audio/${src}`);\n            console.log(`Playing audio: audio/${src}`);\n            audio.onended = resolve;\n            audio.onerror = resolve; // 若音訊失敗也繼續流程\n            audio.play();\n        });\n    }\n    // 顯示一則訊息\n    async function showMessage(msg) {\n        console.log(msg);\n        const type = mapSpeakerToType(msg.speaker);\n        const $template = $(`.message-block.message-${type}`).first();\n        const $newMessage = $template.clone().hide();\n        const $textElement = $newMessage.find('p');\n        $textElement.text('');\n        $('.chat-messages').append($newMessage);\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        let typingPromise;\n        let audioPromise = Promise.resolve();\n        if (type === 'unvoiced') {\n            $textElement.text(msg.text);\n            typingPromise = new Promise((resolve)=>{\n                $newMessage.fadeIn(300, resolve);\n            });\n        } else {\n            $newMessage.show();\n            $newMessage.find('.audio-icon').addClass('show');\n            typingPromise = typeText($textElement, msg.text);\n            if (msg.audio && type === 'teacher') audioPromise = playAudio(msg.audio);\n        }\n        await Promise.all([\n            typingPromise,\n            audioPromise\n        ]);\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        if (type === 'unvoiced') await new Promise((resolve)=>setTimeout(resolve, 500));\n        else {\n            $newMessage.find('.audio-icon').addClass('pause');\n            await new Promise((resolve)=>setTimeout(resolve, 500));\n            $newMessage.find('.audio-icon').removeClass('show pause');\n        }\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        await new Promise((resolve)=>setTimeout(resolve, 1000));\n    }\n    // 顯示一組訊息（greeting、intro、feedback）\n    async function runLessonMessages(messages) {\n        console.log(\"\\uD83D\\uDC49 runLessonMessages \\u6536\\u5230\\u7684 messages:\", messages);\n        for (const msg of messages)await showMessage(msg);\n    }\n    // 課程流程\n    async function runLesson(data) {\n        // 1. greeting\n        //---------------------\n        await runLessonMessages(data.greeting);\n        // 2. concepts\n        for(let c = 0; c < data.concepts.length; c++){\n            const concept = data.concepts[c];\n            // 3. 圖片（如果有）\n            if (concept.image) {\n                const $img = $('<img>', {\n                    class: 'concept-image',\n                    src: `images/${concept.image}`,\n                    alt: 'concept image'\n                });\n                $('.notes-section .card-content').append($img).show(500);\n            }\n            // 4. intro\n            await runLessonMessages(concept.intro);\n            // 5. 選項按鈕\n            for(let i = 0; i < concept.options.length; i++){\n                const option = concept.options[i];\n                const $btn = $('<button>', {\n                    class: 'action-btn choice-btn',\n                    html: `${option.label}: ${option.text}`\n                }).attr('data-concepts', c).attr('data-options', i);\n                if (option.isCorrect) $btn.data('correct', true);\n                $('#choicePopup').append($btn).addClass('show');\n                $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n            }\n            $('.choice-btn').on('click', async function() {\n                const c = $(this).data('concepts');\n                const o = $(this).data('options');\n                const option = lessonData.concepts[c].options[o];\n                // 6.1 禁用所有按鈕\n                $('#choicePopup').removeClass('show');\n                $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                // 6.2 播放音效\n                await playAudio('SFX_Select_01.mp3');\n                // 6.3 顯示學生訊息\n                const $studentMsg = $(`.message-block.message-student`).first().clone();\n                $studentMsg.find('p').text(`${option.label}: ${option.text}`);\n                $('.chat-messages').append($studentMsg);\n                //$('.chat-messages').scrollTop($('.chat-messages')[0].scrollHeight);\n                $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                // 6.4 feedback\n                const turiFeedbacks = option.feedback.turi;\n                const noteFeedbacks = option.feedback.note;\n                console.log(option);\n                // 隨機一個 Turi\n                let messagesToShow = [];\n                if (Array.isArray(turiFeedbacks) && turiFeedbacks.length > 0) {\n                    const randomTuri = turiFeedbacks[Math.floor(Math.random() * turiFeedbacks.length)];\n                    messagesToShow.push(randomTuri);\n                    console.log(randomTuri);\n                }\n                // 接上全部的 note\n                if (Array.isArray(noteFeedbacks) && noteFeedbacks.length > 0) messagesToShow = messagesToShow.concat(noteFeedbacks);\n                console.log(messagesToShow);\n                // 丟進 runLessonMessages → 它就只負責「依序播放」\n                await runLessonMessages(messagesToShow);\n                //6.5 答錯 → reteach → redo → 啟用按鈕\n                if (!option.isCorrect) {\n                    await runLessonMessages(concept.reteach);\n                    await runLessonMessages(concept.redo);\n                    $('#choicePopup').addClass('show');\n                    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                }\n            });\n        }\n    }\n    /* ------------------------------------------------ */ // 啟動流程\n    $('#startLessonBtn').on('click', function() {\n        $('#startPopup').hide();\n        setTimeout(()=>{\n            runLesson(lessonData); // ✅ 修正：傳整個 lessonData\n        }, 500);\n    });\n    /* ------------------------------------------------ */ // Action button interactions\n    $('.action-btn, .menu-btn').on('click', function() {\n        const buttonText = $(this).text().trim();\n        // Add visual feedback\n        $(this).addClass('active');\n        setTimeout(()=>{\n            $(this).removeClass('active');\n        }, 200);\n    });\n    // Handle window resize to maintain layout\n    $(window).on('resize', function() {\n        // Ensure proper height calculations on resize\n        const windowHeight = $(window).height();\n        const headerHeight = $('.header').outerHeight();\n        const remainingHeight = windowHeight - headerHeight;\n        $('.main-content').css('height', remainingHeight + 'px');\n    });\n    // Initial height calculation\n    $(window).trigger('resize');\n})();\n\n//# sourceMappingURL=MyTuri-demo.0e024437.js.map\n","(function () {\n\n  // Collapsible functionality\n  $('.card-header.clickable').on('click', function () {\n    const $card = $(this).closest('.collapsible');\n    const $content = $card.find('.card-content');\n    const $icon = $(this).find('.collapse-icon');\n\n    if ($card.hasClass('collapsed')) {\n      // Expand\n      $card.removeClass('collapsed').addClass('expanded');\n      $content.slideDown(300);\n      $icon.attr('data-lucide', 'chevron-up');\n    } else {\n      // Collapse\n      $card.removeClass('expanded').addClass('collapsed');\n      $content.slideUp(300);\n      $icon.attr('data-lucide', 'chevron-down');\n    }\n\n    // Recreate icons after changing data-lucide attribute\n    setTimeout(() => {\n        lucide.createIcons();\n      }, 100);\n  });\n\n  /* ------------------------------------------------ */\n\n  const lessonData = \n    {\n    \"greeting\": [\n      {\n        \"speaker\": \"Turi\",\n        \"text\": \"Welcome back. Today’s mission: spot linear functions fast — no tricks, just clean reasoning. [TEST: The current sound is the test file...]\",\n        \"audio\": \"M1_Greet_1.mp3\"\n      },\n      {\n        \"speaker\": \"Turi\",\n        \"text\": \"Think of it like speed-dating with graphs — you’ll know in seconds if it’s linear or not.\",\n        \"audio\": \"M1_Greet_2.mp3\"\n      },\n      {\n        \"speaker\": \"UnvoicedNote\",\n        \"text\": \"In live mode, Turi briefly checks goals and prior progress before starting.\"\n      },\n      {\n        \"speaker\": \"Turi\",\n        \"text\": \"You’ll see equations and graphs. Your job: decide if they’re linear and explain why.\",\n        \"audio\": \"M1_Greet_3.mp3\"\n      },\n      {\n        \"speaker\": \"UnvoicedNote\",\n        \"text\": \"In live mode, you’d answer by voice or typing; Turi asks for your reasoning before revealing anything.\",\n        \"audio\": \"M1_Greet_4.mp3\"\n      }\n    ],\n    \"concepts\": [\n      {\n        \"id\": \"A\",\n        \"image\": \"M1_CA.png\",\n        \"intro\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"First, the core idea: A line is linear if it has the same slope everywhere. [TEST: Skip the next three messages for TEST...]\",\n            \"audio\": \"M1_CA_1.mp3\"\n          },\n          // {\n          //   \"speaker\": \"Turi\",\n          //   \"text\": \"In equations, that’s — one x, power of 1, nothing fancy. That one x tells us it’s a linear line.\"\n          // },\n          // {\n          //   \"speaker\": \"Turi\",\n          //   \"text\": \"On a graph, that’s a straight line with no curves and no surprises.\"\n          // },\n          // {\n          //   \"speaker\": \"Turi\",\n          //   \"text\": \"Try one. Pick the linear equation — I’ll ask “why” after.\"\n          // },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, Turi will almost always ask why if the response is an answer without an educated reason. Turi will guide from the response.\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Which equation is linear?\",\n            \"audio\": \"M1_CS1_Prompt.mp3\"\n          }\n        ],\n        \"options\": [\n          {\n            \"label\": \"A\",\n            \"text\": \"\\\\( y = m x + b \\\\)\",\n            \"isCorrect\": true,\n            \"feedback\": {\n              \"turi\": [\n                { \"speaker\": \"Turi\",\n                  \"text\": \"Exactly. One x, power of 1. That’s linear.\",\n                  \"audio\": \"M1_CS1_A_C1.mp3\" \n                },\n                { \"speaker\": \"Turi\",\n                  \"text\": \"Spot on. It fits \",\n                  \"audio\": \"M1_CS1_A_C2.mp3\" }\n              ]\n            }\n          },\n          {\n            \"label\": \"B\",\n            \"text\": \"\\\\( y = x^2 + 3x + 2 \\\\)\",\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Not linear.\",\n                  \"audio\": \"M1_CS1_B_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Nope, quadratic means slope keeps changing.\",\n                  \"audio\": \"M1_CS1_B_W2.mp3\"\n                }\n              ],\n              \"note\": [\n                { \"speaker\": \"UnvoicedNote\",\n                  \"text\": \"In live mode, Turi will plot a quadratic function to illustrate the point.\"\n                }\n              ]\n            }\n          },\n          {\n            \"label\": \"C\",\n            \"text\": \"\\\\( y = -2x^2 + 4 \\\\)\",\n            \"isCorrect\": false,\n            \"feedback\": [{\n              \"speaker\": \"Turi\",\n              \"text\": \"Not quite. This has x squared, that’s quadratic.\",\n              \"audio\": \"M1_CS1_B_C1.mp3\"\n            },\n            {\n              \"speaker\": \"Turi\",\n              \"text\": \"Look again. The squared x means it’s not linear.\",\n              \"audio\": \"M1_CS1_B_C2.mp3\"\n            },\n            {\n              \"speaker\": \"UnvoicedNote\",\n              \"text\": \"二次方的 x，代表這是二次方程式，不是線性。\"\n            }\n            ],\n          },\n          {\n            \"label\": \"D\",\n            \"text\": \"The one that looks nicest.\",\n            \"isCorrect\": false,\n            \"feedback\": [{\n              \"speaker\": \"Turi\",\n              \"text\": \"Not quite. This has x squared, that’s quadratic.\",\n              \"audio\": \"M1_CS1_B_C1.mp3\"\n            },\n            {\n              \"speaker\": \"Turi\",\n              \"text\": \"Look again. The squared x means it’s not linear.\",\n              \"audio\": \"M1_CS1_B_C2.mp3\"\n            },\n            {\n              \"speaker\": \"UnvoicedNote\",\n              \"text\": \"二次方的 x，代表這是二次方程式，不是線性。\"\n            }\n            ],\n          }\n        ],\n        \"reteach\": {\n          \"speaker\": \"Turi\",\n          \"text\": \"Linear means the same slope everywhere.\",\n          \"audio\": \"M1_CS1_Reteach.mp3\"\n        },\n        \"reteach\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Linear means the same slope everywhere.\",\n            \"audio\": \"M1_CS1_Reteach.mp3\"\n          }\n        ],\n        \"redo\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Let’s try that again — which equation is linear?\",\n            \"audio\": \"M1_CS1_Redo.mp3\"\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, this re-ask would be open-ended, not multiple choice, and Turi would not advance until the correct answer is given.\"\n          }\n        ]\n      }\n    ]\n  }\n\n  /* ------------------------------------------------ */\n\n  const $chatContainer = $('.chat-messages');\n  // speaker 轉換成 type\n  function mapSpeakerToType(speaker) {\n    if (speaker === 'Turi') return 'teacher';\n    if (speaker === 'UnvoicedNote') return 'unvoiced';\n    return 'unknown';\n  }\n\n  // 打字效果：逐字顯示文字\n  function typeText($element, text, speed = 50) {\n    return new Promise(resolve => {\n      let i = 0;\n      const interval = setInterval(() => {\n        $element.text($element.text() + text.charAt(i));\n        i++;\n        if (i >= text.length) {\n          clearInterval(interval);\n          resolve();\n        }\n      }, speed);\n    });\n  }\n\n  // 播放音訊\n  function playAudio(src) {\n    return new Promise(resolve => {\n      const audio = new Audio(`audio/${src}`);\n      console.log(`Playing audio: audio/${src}`);\n      audio.onended = resolve;\n      audio.onerror = resolve; // 若音訊失敗也繼續流程\n      audio.play();\n    });\n  }\n\n  // 顯示一則訊息\n  async function showMessage(msg) {\n    console.log(msg)\n    const type = mapSpeakerToType(msg.speaker);\n    const $template = $(`.message-block.message-${type}`).first();\n    const $newMessage = $template.clone().hide();\n    const $textElement = $newMessage.find('p');\n\n    $textElement.text('');\n    $('.chat-messages').append($newMessage);\n\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    let typingPromise;\n    let audioPromise = Promise.resolve();\n\n    if (type === 'unvoiced') {\n      $textElement.text(msg.text);\n      typingPromise = new Promise(resolve => {\n        $newMessage.fadeIn(300, resolve);\n      });\n    } else {\n      $newMessage.show();\n      $newMessage.find('.audio-icon').addClass('show');\n      typingPromise = typeText($textElement, msg.text);\n\n      if (msg.audio && type === 'teacher') {\n        audioPromise = playAudio(msg.audio);\n      }\n    }\n\n    await Promise.all([typingPromise, audioPromise]);\n\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    if (type === 'unvoiced') {\n      await new Promise(resolve => setTimeout(resolve, 500));\n    } else {\n      $newMessage.find('.audio-icon').addClass('pause');\n      await new Promise(resolve => setTimeout(resolve, 500));\n      $newMessage.find('.audio-icon').removeClass('show pause');\n    }\n\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    await new Promise(resolve => setTimeout(resolve, 1000));\n  }\n\n  // 顯示一組訊息（greeting、intro、feedback）\n  async function runLessonMessages(messages) {\n    console.log(\"👉 runLessonMessages 收到的 messages:\", messages);\n    for (const msg of messages) {\n      await showMessage(msg);\n    }\n  }\n\n  // 課程流程\n  async function runLesson(data) {\n    // 1. greeting\n    //---------------------\n    await runLessonMessages(data.greeting);\n\n    // 2. concepts\n    for (let c = 0; c < data.concepts.length; c++) {\n      const concept = data.concepts[c];\n\n      // 3. 圖片（如果有）\n      if (concept.image) {\n        const $img = $('<img>', {\n          class: 'concept-image',\n          src: `images/${concept.image}`,\n          alt: 'concept image'\n        });\n        $('.notes-section .card-content').append($img).show(500);\n      }\n\n      // 4. intro\n      await runLessonMessages(concept.intro);\n\n      // 5. 選項按鈕\n      for (let i = 0; i < concept.options.length; i++) {\n        const option = concept.options[i];\n        const $btn = $('<button>', {\n          class: 'action-btn choice-btn',\n          html: `${option.label}: ${option.text}`\n        }).attr('data-concepts', c).attr('data-options', i);\n\n        if (option.isCorrect) {\n          $btn.data('correct', true);\n        }\n\n        $('#choicePopup').append($btn).addClass('show');\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n      }\n\n\n      $('.choice-btn').on('click', async function () {\n        const c = $(this).data('concepts'); \n        const o = $(this).data('options');\n        const option = lessonData.concepts[c].options[o];\n        // 6.1 禁用所有按鈕\n        $('#choicePopup').removeClass('show');\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n        // 6.2 播放音效\n        await playAudio('SFX_Select_01.mp3');\n\n        // 6.3 顯示學生訊息\n        const $studentMsg = $(`.message-block.message-student`).first().clone();\n        $studentMsg.find('p').text(`${option.label}: ${option.text}`);\n        $('.chat-messages').append($studentMsg);\n        //$('.chat-messages').scrollTop($('.chat-messages')[0].scrollHeight);\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n        // 6.4 feedback\n        const turiFeedbacks = option.feedback.turi;\n        const noteFeedbacks = option.feedback.note;\n\n        console.log(option);\n\n        // 隨機一個 Turi\n        let messagesToShow = [];\n        if (Array.isArray(turiFeedbacks) && turiFeedbacks.length > 0) {\n          const randomTuri = turiFeedbacks[Math.floor(Math.random() * turiFeedbacks.length)];\n          messagesToShow.push(randomTuri);\n          console.log(randomTuri);\n        }\n\n        // 接上全部的 note\n        if (Array.isArray(noteFeedbacks) && noteFeedbacks.length > 0) {\n          messagesToShow = messagesToShow.concat(noteFeedbacks);\n        }\n\n        console.log(messagesToShow);\n\n        // 丟進 runLessonMessages → 它就只負責「依序播放」\n        await runLessonMessages(messagesToShow);\n\n        //6.5 答錯 → reteach → redo → 啟用按鈕\n        if (!option.isCorrect) {\n          await runLessonMessages(concept.reteach);\n          await runLessonMessages(concept.redo);\n          $('#choicePopup').addClass('show');\n          $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        }\n      });\n    }\n  }\n\n  /* ------------------------------------------------ */\n\n  // 啟動流程\n  $('#startLessonBtn').on('click', function () {\n    $('#startPopup').hide();\n    setTimeout(() => {\n      runLesson(lessonData); // ✅ 修正：傳整個 lessonData\n    }, 500);\n  });\n    \n  /* ------------------------------------------------ */\n\n  // Action button interactions\n  $('.action-btn, .menu-btn').on('click', function () {\n    const buttonText = $(this).text().trim();\n    // Add visual feedback\n    $(this).addClass('active');\n    setTimeout(() => {\n      $(this).removeClass('active');\n    }, 200);\n  });\n\n  // Handle window resize to maintain layout\n  $(window).on('resize', function () {\n    // Ensure proper height calculations on resize\n    const windowHeight = $(window).height();\n    const headerHeight = $('.header').outerHeight();\n    const remainingHeight = windowHeight - headerHeight;\n    $('.main-content').css('height', remainingHeight + 'px');\n  });\n\n  // Initial height calculation\n  $(window).trigger('resize');\n})();"],"names":["$","on","$card","closest","$content","find","$icon","hasClass","removeClass","addClass","slideDown","attr","slideUp","setTimeout","lucide","createIcons","lessonData","$chatContainer","playAudio","src","Promise","resolve","audio","Audio","console","log","onended","onerror","play","showMessage","msg","speaker","typingPromise","type","$newMessage","$template","first","clone","hide","$textElement","text","append","scrollTop","scrollHeight","audioPromise","fadeIn","show","typeText","$element","speed","i","interval","setInterval","charAt","length","clearInterval","all","runLessonMessages","messages","runLesson","data","greeting","c","concepts","concept","image","$img","class","alt","intro","options","option","$btn","html","label","isCorrect","o","$studentMsg","turiFeedbacks","feedback","turi","noteFeedbacks","note","messagesToShow","Array","isArray","randomTuri","Math","floor","random","push","concat","reteach","redo","trim","window","windowHeight","height","headerHeight","outerHeight","css","remainingHeight","trigger"],"version":3,"file":"MyTuri-demo.0e024437.js.map"}