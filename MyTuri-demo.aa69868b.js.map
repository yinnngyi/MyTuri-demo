{"mappings":"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","sources":["src/js/main.js"],"sourcesContent":["(function () {\n\n  // Collapsible functionality\n  $('.card-header.clickable').on('click', function () {\n    const $card = $(this).closest('.collapsible');\n    const $content = $card.find('.card-content');\n    const $icon = $(this).find('.collapse-icon');\n\n    if ($card.hasClass('collapsed')) {\n      // Expand\n      $card.removeClass('collapsed').addClass('expanded');\n      $content.slideDown(300);\n      $icon.attr('data-lucide', 'chevron-up');\n    } else {\n      // Collapse\n      $card.removeClass('expanded').addClass('collapsed');\n      $content.slideUp(300);\n      $icon.attr('data-lucide', 'chevron-down');\n    }\n\n    // Recreate icons after changing data-lucide attribute\n    setTimeout(() => {\n        lucide.createIcons();\n      }, 100);\n  });\n\n  /* ------------------------------------------------ */\n\n  const $chatContainer = $('.chat-messages');\n  // 打字效果：逐字顯示文字\n  function typeText($element, text, speed = 50) {\n    return new Promise(resolve => {\n      // 把字串丟給 DOMParser 解析成 DOM 結構\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(`<div>${text}</div>`, \"text/html\");\n      const nodes = Array.from(doc.body.firstChild.childNodes);\n\n      let nodeIndex = 0;\n      let charIndex = 0;\n\n      function typeNext() {\n        if (nodeIndex >= nodes.length) {\n          resolve();\n          return;\n        }\n\n        const node = nodes[nodeIndex];\n\n        if (node.nodeType === Node.TEXT_NODE) {\n          // 文字節點 → 逐字輸出\n          const chars = node.textContent;\n          if (charIndex < chars.length) {\n            $element.html($element.html() + chars.charAt(charIndex));\n            charIndex++;\n            setTimeout(typeNext, speed);\n          } else {\n            nodeIndex++;\n            charIndex = 0;\n            typeNext();\n          }\n        } else {\n          // HTML 或 MathML → 整塊直接插入\n          $element.append(node.cloneNode(true));\n          nodeIndex++;\n          typeNext();\n        }\n      }\n\n      typeNext();\n    });\n  }\n  \n\n  // 播放音訊\n  function playAudio(src) {\n    return new Promise(resolve => {\n      const audio = new Audio(`audio/${src}`);\n      console.log(`Playing audio: audio/${src}`);\n      audio.onended = resolve;\n      audio.onerror = resolve; // 若音訊失敗也繼續流程\n      audio.play();\n    });\n  }\n\n  // 顯示一則訊息\n  async function showMessage(msg) {\n    const type = msg.speaker;\n    const $template = $(`.message-block.message-${type}`).first();\n    const $newMessage = $template.clone().hide();\n    const $textElement = $newMessage.find('p');\n\n    $textElement.text('');\n    $('.chat-messages').append($newMessage);\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    let typingPromise;\n    let audioPromise = Promise.resolve();\n\n    switch (type) {\n      case 'UnvoicedNote':\n        $textElement.text(msg.text);\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        typingPromise = new Promise(resolve => {\n          $newMessage.fadeIn(300, resolve);\n        });\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        break;\n\n      case 'Turi':\n        typingPromise = typeText($textElement, msg.text);  \n        $newMessage.show();\n        $newMessage.find('.audio-icon').addClass('show');\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        if (msg.audio) {\n          audioPromise = playAudio(msg.audio);\n        }\n        break;\n\n      case 'student':\n        $textElement.html(msg.text);\n        $newMessage.show();\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        break;\n\n      default:\n        console.warn(`Unknown message type: ${type}`);\n        break;\n    }\n\n    await Promise.all([typingPromise, audioPromise]);\n\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    if (type === 'UnvoicedNote') {\n      await new Promise(resolve => setTimeout(resolve, 500));\n    } else {\n      $newMessage.find('.audio-icon').addClass('pause');\n      await new Promise(resolve => setTimeout(resolve, 500));\n      $newMessage.find('.audio-icon').removeClass('show pause');\n    }\n\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    await new Promise(resolve => setTimeout(resolve, 1000));\n  }\n\n  // 顯示一組訊息（greeting、intro、feedback）\n  async function runLessonMessages(messages) {\n    if (!Array.isArray(messages) || messages.length === 0) {\n      return; // 沒東西就直接結束\n    }\n    for (const msg of messages) {\n      if (msg.image) {\n        const $img = $('<img>', {\n          class: 'concept-image',\n          src: `images/${msg.image}`,\n          alt: 'concept image'\n        });\n        $('.notes-section .card-content').empty();\n        $('.app-loader').removeClass('hidden').fadeIn(100);\n        setTimeout(() => {\n          $('.app-loader').fadeOut(200, () => {\n            $('.notes-section .card-content').html($img).fadeIn(500);\n          });\n        }, 300);\n      }\n      await showMessage(msg);\n    }\n  }  \n\n  // 課程流程\n\n\n\n  async function runLesson(data) {\n    // 1. greeting\n    await runLessonMessages(data.greeting);\n\n    // 2. concepts\n    let currentConcept = 0;\n    async function runConcept(conceptIndex) {\n      const concept = data.concepts[conceptIndex];\n      // 3. intro\n      await runLessonMessages(concept.intro);\n\n      // 4. Choice\n      return new Promise(resolve => {\n        function showOptions(conceptIndex) {\n          const concept = data.concepts[conceptIndex];\n\n          // 4.1 Choice Button\n          $('#choicePopup').empty();\n          concept.options.forEach((option, i) => {\n            const $btn = $('<button>', {\n              class: 'action-btn choice-btn',\n              html: `<span class=\"choice\">${option.label}.</span>${option.text}`\n            }).attr('data-concepts', conceptIndex)\n              .attr('data-options', i);\n            if (option.isCorrect) {\n              $btn.data('correct', true);\n            }\n            $('#choicePopup').append($btn);\n            $('body').addClass('show-choice');\n            $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n          });\n\n          // 5. Click\n          $('.choice-btn').off('click').on('click', async function () {\n            const c = $(this).data('concepts');\n            const o = $(this).data('options');\n            const option = data.concepts[c].options[o];\n\n            // 5.1 hide choicePopup\n            $('body').removeClass('show-choice');\n            $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n            // 5.2 play audio\n            await playAudio('SFX_Select_01.mp3');\n\n            // 5.3 show student Msg\n            const studentMsg = [{\n              speaker: 'student',\n              text: `<span class=\"choice\">${option.label}.</span>${option.text}`,\n            }];\n            await runLessonMessages(studentMsg);\n\n            // 5.4 feedback\n            const turiFeedbacks = option.feedback.turi;\n            const noteFeedbacks = option.feedback.note;\n\n            let messagesToShow = [];\n            if (Array.isArray(turiFeedbacks) && turiFeedbacks.length > 0) {\n              const randomTuri = turiFeedbacks[Math.floor(Math.random() * turiFeedbacks.length)];\n              messagesToShow.push(randomTuri);\n            }\n            if (Array.isArray(noteFeedbacks) && noteFeedbacks.length > 0) {\n              messagesToShow = messagesToShow.concat(noteFeedbacks);\n            }\n            await runLessonMessages(messagesToShow);\n\n            // 5.5 isCorrect\n            if (option.isCorrect) {\n              // ✅\n              currentConcept++;\n              if (currentConcept < data.concepts.length) {\n                await runConcept(currentConcept);\n                resolve();\n              } else {\n                resolve();\n              }\n            } else {\n              // ❌\n              await runLessonMessages(concept.reteach);\n              await runLessonMessages(concept.redo);\n              showOptions(conceptIndex);\n              $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n            }\n          });\n        }\n        showOptions(conceptIndex);\n      });\n    }\n\n    // 2. concepts\n    await runConcept(currentConcept);\n\n    // 3. End\n    await runLessonMessages(data.close);\n  }\n\n  /* ------------------------------------------------ */\n\n  // 啟動流程\n  $('#startLessonBtn').on('click', function () {\n    $('#startPopup').hide();\n    setTimeout(() => {\n      runLesson(lessonData); // ✅ 修正：傳整個 lessonData\n    }, 500);\n  });\n    \n  /* ------------------------------------------------ */\n\n  // Action button interactions\n  $('.action-btn, .menu-btn').on('click', function () {\n    const buttonText = $(this).text().trim();\n    // Add visual feedback\n    $(this).addClass('active');\n    setTimeout(() => {\n      $(this).removeClass('active');\n    }, 200);\n  });\n\n  // Handle window resize to maintain layout\n  $(window).on('resize', function () {\n    // Ensure proper height calculations on resize\n    const windowHeight = $(window).height();\n    const headerHeight = $('.header').outerHeight();\n    const remainingHeight = windowHeight - headerHeight;\n    $('.main-content').css('height', remainingHeight + 'px');\n  });\n\n  // Initial height calculation\n  $(window).trigger('resize');\n})();"],"names":[],"version":3,"file":"MyTuri-demo.aa69868b.js.map","sourceRoot":"/__parcel_source_root/"}