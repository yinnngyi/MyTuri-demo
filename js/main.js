!function(){$(".card-header.clickable").on("click",function(){let e=$(this).closest(".collapsible"),t=e.find(".card-content"),o=$(this).find(".collapse-icon");e.hasClass("collapsed")?(e.removeClass("collapsed").addClass("expanded"),t.slideDown(300),o.attr("data-lucide","chevron-up")):(e.removeClass("expanded").addClass("collapsed"),t.slideUp(300),o.attr("data-lucide","chevron-down")),setTimeout(()=>{lucide.createIcons()},100)});let e=$(".chat-messages");function t(e){return new Promise(t=>{let o=new Audio(`audio/${e}`);console.log(`Playing audio: audio/${e}`),o.onended=t,o.onerror=t,o.play()})}async function o(o){let a,s=o.speaker,i=$(`.message-block.message-${s}`).first().clone().hide(),n=i.find("p");n.text(""),$(".chat-messages").append(i),e.scrollTop(e[0].scrollHeight);let c=Promise.resolve();switch(s){case"UnvoicedNote":n.text(o.text),e.scrollTop(e[0].scrollHeight),a=new Promise(e=>{i.fadeIn(300,e)}),e.scrollTop(e[0].scrollHeight);break;case"Turi":a=function(e,t,o=50){return new Promise(a=>{let s=Array.from(new DOMParser().parseFromString(`<div>${t}</div>`,"text/html").body.firstChild.childNodes),i=0,n=0;!function t(){if(i>=s.length)return void a();let c=s[i];if(c.nodeType===Node.TEXT_NODE){let a=c.textContent;n<a.length?(e.html(e.html()+a.charAt(n)),n++,setTimeout(t,o)):(i++,n=0,t())}else e.append(c.cloneNode(!0)),i++,t()}()})}(n,o.text),i.show(),i.find(".audio-icon").addClass("show"),e.scrollTop(e[0].scrollHeight),o.audio&&(c=t(o.audio));break;case"student":n.html(o.text),i.show(),e.scrollTop(e[0].scrollHeight);break;default:console.warn(`Unknown message type: ${s}`)}await Promise.all([a,c]),e.scrollTop(e[0].scrollHeight),"UnvoicedNote"===s?await new Promise(e=>setTimeout(e,500)):(i.find(".audio-icon").addClass("pause"),await new Promise(e=>setTimeout(e,500)),i.find(".audio-icon").removeClass("show pause")),e.scrollTop(e[0].scrollHeight),await new Promise(e=>setTimeout(e,1e3))}async function a(e){if(Array.isArray(e)&&0!==e.length)for(let t of e){if(t.image){let e=$("<img>",{class:"concept-image",src:`images/${t.image}`,alt:"concept image"});$(".notes-section .card-content").empty(),$(".app-loader").removeClass("hidden").fadeIn(100),setTimeout(()=>{$(".app-loader").fadeOut(200,()=>{$(".notes-section .card-content").html(e).fadeIn(500)})},300)}await o(t)}}async function s(o){await a(o.greeting);let s=0;async function i(n){let c=o.concepts[n];return await a(c.intro),new Promise(c=>{!function n(l){let r=o.concepts[l];$("#choicePopup").empty(),r.options.forEach((t,o)=>{let a=$("<button>",{class:"action-btn choice-btn",html:`<span class="choice">${t.label}.</span>${t.text}`}).attr("data-concepts",l).attr("data-options",o);t.isCorrect&&a.data("correct",!0),$("#choicePopup").append(a),$("body").addClass("show-choice"),e.scrollTop(e[0].scrollHeight)}),$(".choice-btn").off("click").on("click",async function(){let d=$(this).data("concepts"),h=$(this).data("options"),p=o.concepts[d].options[h];$("body").removeClass("show-choice"),e.scrollTop(e[0].scrollHeight),await t("SFX_Select_01.mp3");let u=[{speaker:"student",text:`<span class="choice">${p.label}.</span>${p.text}`}];await a(u);let m=p.feedback.turi,f=p.feedback.note,w=[];if(Array.isArray(m)&&m.length>0){let e=m[Math.floor(Math.random()*m.length)];w.push(e)}Array.isArray(f)&&f.length>0&&(w=w.concat(f)),await a(w),p.isCorrect?(++s<o.concepts.length&&await i(s),c()):(await a(r.reteach),await a(r.redo),n(l),e.scrollTop(e[0].scrollHeight))})}(n)})}await i(s),await a(o.close)}$("#startLessonBtn").on("click",function(){$("#startPopup").hide(),setTimeout(()=>{s(lessonData)},500)}),$(".action-btn, .menu-btn").on("click",function(){$(this).text().trim(),$(this).addClass("active"),setTimeout(()=>{$(this).removeClass("active")},200)}),$(window).on("resize",function(){let e=$(window).height(),t=$(".header").outerHeight();$(".main-content").css("height",e-t+"px")}),$(window).trigger("resize")}();
//# sourceMappingURL=main.js.map
