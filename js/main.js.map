{"mappings":"CCAC,AAAA,WAGC,EAAE,0BAA0B,EAAE,CAAC,QAAS,WACtC,IAAM,EAAQ,EAAE,IAAI,EAAE,OAAO,CAAC,gBACxB,EAAW,EAAM,IAAI,CAAC,iBACtB,EAAQ,EAAE,IAAI,EAAE,IAAI,CAAC,kBAEvB,EAAM,QAAQ,CAAC,cAEjB,EAAM,WAAW,CAAC,aAAa,QAAQ,CAAC,YACxC,EAAS,SAAS,CAAC,KACnB,EAAM,IAAI,CAAC,cAAe,gBAG1B,EAAM,WAAW,CAAC,YAAY,QAAQ,CAAC,aACvC,EAAS,OAAO,CAAC,KACjB,EAAM,IAAI,CAAC,cAAe,iBAI5B,WAAW,KACP,OAAO,WAAW,EACpB,EAAG,IACP,GAIA,IAAM,EACJ,CACA,SAAY,CACV,CACE,QAAW,OACX,KAAQ,+FACR,MAAS,0BACX,EACA,CACE,QAAW,OACX,KAAQ,4FACR,MAAS,0BACX,EACA,CACE,QAAW,eACX,KAAQ,oEACV,EACA,CACE,QAAW,OACX,KAAQ,uFACR,MAAS,0BACX,EACA,CACE,QAAW,eACX,KAAQ,mDACR,MAAS,0BACX,EACD,CACD,SAAY,CACV,CACE,GAAM,IACN,MAAS,CACP,CACE,QAAW,OACX,KAAQ,qFACR,MAAS,wBACT,MAAS,WACX,EACA,CACE,QAAW,OACX,KAAQ,CAAC,uQAAkP,CAAC,CAC5P,MAAS,uBACX,EACA,CACE,QAAW,OACX,KAAQ,sEACR,MAAS,uBACX,EACA,CACE,QAAW,OACX,KAAQ,4DACR,MAAS,uBACX,EACA,CACE,QAAW,eACX,KAAQ,sEACV,EACA,CACE,QAAW,OACX,KAAQ,4BACR,MAAS,6BACX,EACD,CACD,QAAW,CACT,CACE,MAAS,IACT,KAAQ,oJACR,UAAa,CAAA,EACb,SAAY,CACV,KAAQ,CACN,CAAE,QAAW,OACX,KAAQ,6CACR,MAAS,oCACX,EACA,CAAE,QAAW,OACX,KAAQ,gLACR,MAAS,oCAAqC,EACjD,AACH,CACF,EACA,CACE,MAAS,IACT,KAAQ,CAAC,kLAA2K,CAAC,CACrL,UAAa,CAAA,EACb,SAAY,CACV,KAAQ,CACN,CACE,QAAW,OACX,KAAQ,oKACR,MAAS,oCACX,EACA,CACE,QAAW,OACX,KAAQ,8CACR,MAAS,oCACX,EACD,CACD,KAAQ,CACN,CAAE,QAAW,eACX,KAAQ,+CACV,EACD,AACH,CACF,EACA,CACE,MAAS,IACT,KAAQ,+IACR,UAAa,CAAA,EACb,SAAY,CACV,KAAQ,CACN,CACE,QAAW,OACX,KAAQ,mKACR,MAAS,oCACX,EACA,CACE,QAAW,OACX,KAAQ,2CACR,MAAS,oCACX,EACD,CACD,KAAQ,CACN,CACE,QAAW,eACX,KAAQ,+CACV,EACD,AACH,CACF,EACA,CACE,MAAS,IACT,KAAQ,6BACR,UAAa,CAAA,EACb,SAAY,CACV,KAAQ,CACN,CACE,QAAW,OACX,KAAQ,iDACR,MAAS,oCACX,EACA,CACE,QAAW,OACX,KAAQ,uCACR,MAAS,oCACX,EACD,CACD,KAAQ,CACN,CACE,QAAW,eACX,KAAQ,mEACV,EACD,AACH,CACF,EACD,CACD,QAAW,CACT,CACE,QAAW,OACX,KAAQ,CAAC,uVAAgV,CAAC,CAC1V,MAAS,uCACX,EACD,CACD,KAAQ,CACN,CACE,QAAW,OACX,KAAQ,mDACR,MAAS,oCACX,EACA,CACE,QAAW,eACX,KAAQ,2DACV,EACD,AACH,EACA,CACE,GAAM,IACN,MAAS,CACP,CACE,QAAW,OACX,KAAQ,8EACR,MAAS,wBACT,MAAS,WACX,EACA,CACE,QAAW,OACX,KAAQ,+GACR,MAAS,uBACX,EACA,CACE,QAAW,OACX,KAAQ,CAAC,48BAA87B,CAAC,CACx8B,MAAS,uBACX,EACA,CACE,QAAW,OACX,KAAQ,0VACR,MAAS,uBACX,EACA,CACE,QAAW,OACX,KAAQ,kGACR,MAAS,6BACT,MAAS,aACX,EACA,CACE,QAAW,eACX,KAAQ,+LACV,EACD,CACD,QAAW,CACT,CACE,MAAS,IACT,KAAQ,sHACR,UAAa,CAAA,EACb,SAAY,CACV,KAAQ,CACN,CACE,QAAW,OACX,KAAQ,sCACR,MAAS,0BACX,EACA,CACE,QAAW,OACX,KAAQ,gFACR,MAAS,0BACX,EACD,AACH,CACF,EACA,CACE,MAAS,IACT,KAAQ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","sources":["<anon>","src/js/main.js"],"sourcesContent":["(function () {\n(function() {\n    // Collapsible functionality\n    $('.card-header.clickable').on('click', function() {\n        const $card = $(this).closest('.collapsible');\n        const $content = $card.find('.card-content');\n        const $icon = $(this).find('.collapse-icon');\n        if ($card.hasClass('collapsed')) {\n            // Expand\n            $card.removeClass('collapsed').addClass('expanded');\n            $content.slideDown(300);\n            $icon.attr('data-lucide', 'chevron-up');\n        } else {\n            // Collapse\n            $card.removeClass('expanded').addClass('collapsed');\n            $content.slideUp(300);\n            $icon.attr('data-lucide', 'chevron-down');\n        }\n        // Recreate icons after changing data-lucide attribute\n        setTimeout(()=>{\n            lucide.createIcons();\n        }, 100);\n    });\n    /* ------------------------------------------------ */ const lessonData = {\n        \"greeting\": [\n            {\n                \"speaker\": \"Turi\",\n                \"text\": \"Welcome back. Today\\u2019s mission: spot linear functions fast \\u2014 no tricks, just clean reasoning.\",\n                \"audio\": \"Greetings/M1_Greet_1.mp3\"\n            },\n            {\n                \"speaker\": \"Turi\",\n                \"text\": \"Think of it like speed-dating with graphs \\u2014 you\\u2019ll know in seconds if it\\u2019s linear or not.\",\n                \"audio\": \"Greetings/M1_Greet_2.mp3\"\n            },\n            {\n                \"speaker\": \"UnvoicedNote\",\n                \"text\": \"In live mode, Turi makes sure students are ready before beginning.\"\n            },\n            {\n                \"speaker\": \"Turi\",\n                \"text\": \"You\\u2019ll see equations and graphs. Your job: decide if they\\u2019re linear and explain why.\",\n                \"audio\": \"Greetings/M1_Greet_3.mp3\"\n            },\n            {\n                \"speaker\": \"UnvoicedNote\",\n                \"text\": \"In live mode, you can answer by voice or typing.\",\n                \"audio\": \"Greetings/M1_Greet_4.mp3\"\n            }\n        ],\n        \"concepts\": [\n            {\n                \"id\": \"A\",\n                \"intro\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"First, the core idea: A line is linear if it has the <b>same slope everywhere</b>.\",\n                        \"audio\": \"Concept A/M1_CA_1.mp3\",\n                        \"image\": \"M1_CA.png\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": `In equations, that\\u{2019}s <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mi>m</mi><mi>x</mi><mo>+</mo><mi>b</mi></math></span> \\u{2014} one x, power of 1, nothing fancy. That one x tells us it\\u{2019}s a linear line.`,\n                        \"audio\": \"Concept A/M1_CA_2.mp3\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"On a graph, that\\u2019s a straight line with no curves and no surprises.\",\n                        \"audio\": \"Concept A/M1_CA_3.mp3\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Try one. Pick the linear equation \\u2014 I\\u2019ll ask \\u201Cwhy\\u201D after.\",\n                        \"audio\": \"Concept A/M1_CA_4.mp3\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, Turi may ask follow-up questions to keep you thinking.\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Which equation is linear?\",\n                        \"audio\": \"Concept A/M1_CS1_Prompt.mp3\"\n                    }\n                ],\n                \"options\": [\n                    {\n                        \"label\": \"A\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mn>2</mn><mi>x</mi><mo>+</mo><mn>3</mn></math></span>`,\n                        \"isCorrect\": true,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Exactly. One x, power of 1. That\\u2019s linear.\",\n                                    \"audio\": \"Choice 1 Responses/M1_CS1_A_C1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Spot on. It fits <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mi>m</mi><mi>x</mi><mo>+</mo><mi>b</mi></math></span> perfectly.`,\n                                    \"audio\": \"Choice 1 Responses/M1_CS1_A_C2.mp3\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"B\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup><mo>\\u{2212}</mo><mn>4</mn></math></span>`,\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Not linear. <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup></math></span> curves the graph.`,\n                                    \"audio\": \"Choice 1 Responses/M1_CS1_B_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Nope, quadratic means slope keeps changing.\",\n                                    \"audio\": \"Choice 1 Responses/M1_CS1_B_W2.mp3\"\n                                }\n                            ],\n                            \"note\": [\n                                {\n                                    \"speaker\": \"UnvoicedNote\",\n                                    \"text\": \"In live mode, Turi can show helpful examples.\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"C\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mfrac><mn>1</mn><mi>x</mi></mfrac></math></span>`,\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Not quite. <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mfrac><mn>1</mn><mi>x</mi></mfrac></math></span> bends and never straightens.`,\n                                    \"audio\": \"Choice 1 Responses/M1_CS1_C_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Nope, reciprocal graphs split and curve.\",\n                                    \"audio\": \"Choice 1 Responses/M1_CS1_C_W2.mp3\"\n                                }\n                            ],\n                            \"note\": [\n                                {\n                                    \"speaker\": \"UnvoicedNote\",\n                                    \"text\": \"In live mode, Turi can show helpful examples.\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"D\",\n                        \"text\": \"The one that looks nicest.\",\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Cute, but squinting doesn\\u2019t straighten curves.\",\n                                    \"audio\": \"Choice 1 Responses/M1_CS1_D_J1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Funny, but the graph\\u2019s still curved.\",\n                                    \"audio\": \"Choice 1 Responses/M1_CS1_D_J2.mp3\"\n                                }\n                            ],\n                            \"note\": [\n                                {\n                                    \"speaker\": \"UnvoicedNote\",\n                                    \"text\": \"In live mode, Turi sometimes uses humor to keep students engaged.\"\n                                }\n                            ]\n                        }\n                    }\n                ],\n                \"reteach\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": `Linear means the same slope everywhere. If you see <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup></math></span> or <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mfrac><mn>1</mn><mi>x</mi></mfrac></math></span> , slope changes \\u{2014} not linear.`,\n                        \"audio\": \"Choice 1 Responses/M1_CS1_Reteach.mp3\"\n                    }\n                ],\n                \"redo\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Let\\u2019s try that again \\u2014 which equation is linear?\",\n                        \"audio\": \"Choice 1 Responses/M1_CS1_Redo.mp3\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, Turi may re-ask until the concept is clear.\"\n                    }\n                ]\n            },\n            {\n                \"id\": \"B\",\n                \"intro\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"If you know a line is linear, two points are enough to determine the slope.\",\n                        \"audio\": \"Concept B/M1_CB_1.mp3\",\n                        \"image\": \"M1_CB.png\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Moreover, once you find the slope, you can write the whole equation if you know the y-intercept, or b value.\",\n                        \"audio\": \"Concept B/M1_CB_2.mp3\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": `Look at the example question. The line is linear and it goes through points <b>(1,2)</b> and <b>(3,6)</b>. Slope is <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>m</mi><mo>=</mo><mfrac><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>6</mn><mo>\\u{2212}</mo><mn>2</mn></mrow></mstyle></mrow><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>3</mn><mo>\\u{2212}</mo><mn>1</mn></mrow></mstyle></mrow></mfrac><mo>=</mo><mfrac><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>4</mn></mrow></mstyle></mrow><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>2</mn></mrow></mstyle></mrow></mfrac><mo>=</mo><mn>2</mn></math></span>.`,\n                        \"audio\": \"Concept B/M1_CB_3.mp3\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": `Since the line goes through (0, 0), y-intercept is 0. Therefore, the equation of the line is: <span><math xmlns=\\\"http://www.w3.org/1998/Math/MathML\\\"><mi>y</mi><mo>=</mo><mn>2</mn><mi>x</mi><mo>+</mo><mn>0</mn></math></span> or <span><math xmlns=\\\"http://www.w3.org/1998/Math/MathML\\\"><mi>y</mi><mo>=</mo><mn>2</mn><mi>x</mi></math></span>. Done.`,\n                        \"audio\": \"Concept B/M1_CB_4.mp3\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Your turn: A straight line goes through points <b>(2,5)</b> and <b>(4,9)</b>. What\\u2019s the slope?\",\n                        \"audio\": \"Concept B/M1_CB_Prompt.mp3\",\n                        \"image\": \"M1_CB_Q.png\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, students can ask for more time or let Turi know they\\u2019re still working. Turi will wait, but repeated requests or prolonged idling will be flagged as possible off-task behavior.\"\n                    }\n                ],\n                \"options\": [\n                    {\n                        \"label\": \"A\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>m</mi><mo>=</mo><mn>1</mn></math></span>`,\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Not quite. Slope is rise over run. `,\n                                    \"audio\": \"Concept B/M1_CB_A_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Close, you calculated rise/run wrong. Rise is vertical and run is horizontal.\",\n                                    \"audio\": \"Concept B/M1_CB_A_W2.mp3\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"B\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>m</mi><mo>=</mo><mn>2</mn></math></span>`,\n                        \"isCorrect\": true,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Correct. Rise is 4, run is 2, slope is 2. `,\n                                    \"audio\": \"Concept B/M1_CB_B_C1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Nice. Slope is <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mfrac><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>4</mn></mrow></mstyle></mrow><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>2</mn></mrow></mstyle></mrow></mfrac><mo>=</mo><mn>2</mn></math></span>.`,\n                                    \"audio\": \"Concept B/M1_CB_B_C2.mp3\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"C\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>m</mi><mo>=</mo><mfrac><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>1</mn></mrow></mstyle></mrow><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>2</mn></mrow></mstyle></mrow></mfrac></math></span>`,\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Not quite. You flipped rise/run.`,\n                                    \"audio\": \"Concept B/M1_CB_C_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Nope, slope is rise over run, not the other way.\",\n                                    \"audio\": \"Concept B/M1_CB_C_W2.mp3\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"D\",\n                        \"text\": \"No slope, too tired.\",\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"note\": [\n                                {\n                                    \"speaker\": \"UnvoicedNote\",\n                                    \"text\": \"In live mode, Turi may steer the student back on track if jokes continue.\"\n                                }\n                            ]\n                        }\n                    }\n                ],\n                \"redo\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Try again. What\\u2019s the slope for between points <b>(2,5)</b> and <b>(4,9)</b>?\",\n                        \"audio\": \"Concept B/M1_CB_Redo.mp3\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, Turi guides students toward the right answer before moving on.\"\n                    }\n                ]\n            },\n            {\n                \"id\": \"C\",\n                \"intro\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Last check: equations can be written in many forms \\u2014 still linear if the slope stays constant.\",\n                        \"audio\": \"Concept C/M1_CC_1.mp3\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": `For examples: <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>\\u{2212}</mo><mn>3</mn><mo>=</mo><mn>2</mn><mo stretchy=\"false\">(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></math></span> or <math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>2</mn><mi>x</mi><mo>\\u{2212}</mo><mi>y</mi><mo>=</mo><mn>4</mn></math>. Different look, same slope rule.`,\n                        \"audio\": \"Concept C/M1_CC_2.mp3\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, Turi can adjust the amount of algebra shown.\"\n                    },\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Which of these is <b>not</b> linear?\",\n                        \"audio\": \"Concept C/M1_CC_Prompt.mp3\",\n                        \"image\": \"M1_CC_Q.png\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, students can ask for more time, and Turi will wait.\"\n                    }\n                ],\n                \"options\": [\n                    {\n                        \"label\": \"A\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mo>\\u{2212}</mo><mn>5</mn><mi>x</mi><mo>+</mo><mn>7</mn></math></span>`,\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Nope, that is still linear. The slope is \\u22125\",\n                                    \"audio\": \"Concept C/M1_CC_A_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Not quite. It fits <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mi>m</mi><mi>x</mi><mo>+</mo><mi>b</mi></math></span>, so it\\u{2019}s linear.`,\n                                    \"audio\": \"Concept C/M1_CC_A_W2.mp3\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"B\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>3</mn><mi>y</mi><mo>\\u{2212}</mo><mn>6</mn><mi>x</mi><mo>=</mo><mn>12</mn></math></span>`,\n                        \"isCorrect\": false,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Nope, you can rearrange to <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mn>2</mn><mi>x</mi><mo>+</mo><mn>4</mn></math></span> , which is linear.`,\n                                    \"audio\": \"Concept C/M1_CC_B_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Not quite. This is just in standard form, still linear.\",\n                                    \"audio\": \"Concept C/M1_CC_B_W2.mp3\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"C\",\n                        \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mn>4</mn><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup><mo>+</mo><mn>1</mn></math></span>`,\n                        \"isCorrect\": true,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `NCorrect. <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup></math></span> makes it quadratic, not linear.`,\n                                    \"audio\": \"Concept C/M1_CC_C_C1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Exactly. Squared x makes it quadratic, so it\\u2019s out.\",\n                                    \"audio\": \"Concept C/M1_CC_C_C2.mp3\"\n                                }\n                            ]\n                        }\n                    }\n                ],\n                \"reteach\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": `Linear means no exponents other than 1, no variables multiplied together. `,\n                        \"audio\": \"Concept C/M1_CC_Reteach.mp3\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, Turi can handle unexpected answers appropriately.\"\n                    }\n                ],\n                \"redo\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Try again \\u2014 which of these is <b>not</b> linear?\",\n                        \"audio\": \"Concept C/M1_CC_Redo.mp3\"\n                    },\n                    {\n                        \"speaker\": \"UnvoicedNote\",\n                        \"text\": \"In live mode, this re-ask would be open-ended, and Turi would guide the student until correct before moving on.\"\n                    }\n                ]\n            },\n            {\n                \"id\": \"Quick Fire\",\n                \"intro\": [\n                    {\n                        \"speaker\": \"Turi\",\n                        \"text\": \"Before we wrap \\u2014 True or False: All linear equations have the same slope.\",\n                        \"audio\": \"Quick Fire/M1_QF_Intro.mp3\"\n                    }\n                ],\n                \"options\": [\n                    {\n                        \"label\": \"True\",\n                        \"text\": '',\n                        \"isCorrect\": true,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Nope, slope depends on the equation. Linear just means slope is constant within one equation.\",\n                                    \"audio\": \"Quick Fire/M1_QF_A_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Not quite. Different lines can have different slopes. Constant slope only applies within a single equation.`,\n                                    \"audio\": \"Quick Fire/M1_QF_A_W2.mp3\"\n                                }\n                            ]\n                        }\n                    },\n                    {\n                        \"label\": \"False\",\n                        \"text\": '',\n                        \"isCorrect\": true,\n                        \"feedback\": {\n                            \"turi\": [\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": \"Exactly. Slope varies between different lines, but stays constant within one.\",\n                                    \"audio\": \"Quick Fire/M1_QF_A_W1.mp3\"\n                                },\n                                {\n                                    \"speaker\": \"Turi\",\n                                    \"text\": `Correct. Each linear equation has its own slope.`,\n                                    \"audio\": \"Quick Fire/M1_QF_A_W2.mp3\"\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        ],\n        \"close\": [\n            {\n                \"speaker\": \"Turi\",\n                \"text\": \"And that\\u2019s it for today\\u2019s run. In live mode, we\\u2019d dive into tougher problems next. Keep that brain warmed up!\",\n                \"audio\": \"Quick Fire/M1_QF_Close.mp3\"\n            },\n            {\n                \"speaker\": \"UnvoicedNote\",\n                \"text\": \"In live mode, students answer in their own words. Turi adapts to their pace, keeps them engaged, and guides them back on track until the concept clicks\"\n            }\n        ]\n    };\n    /* ------------------------------------------------ */ const $chatContainer = $('.chat-messages');\n    // 打字效果：逐字顯示文字\n    function typeText($element, text, speed = 50) {\n        return new Promise((resolve)=>{\n            // 把字串丟給 DOMParser 解析成 DOM 結構\n            const parser = new DOMParser();\n            const doc = parser.parseFromString(`<div>${text}</div>`, \"text/html\");\n            const nodes = Array.from(doc.body.firstChild.childNodes);\n            let nodeIndex = 0;\n            let charIndex = 0;\n            function typeNext() {\n                if (nodeIndex >= nodes.length) {\n                    resolve();\n                    return;\n                }\n                const node = nodes[nodeIndex];\n                if (node.nodeType === Node.TEXT_NODE) {\n                    // 文字節點 → 逐字輸出\n                    const chars = node.textContent;\n                    if (charIndex < chars.length) {\n                        $element.html($element.html() + chars.charAt(charIndex));\n                        charIndex++;\n                        setTimeout(typeNext, speed);\n                    } else {\n                        nodeIndex++;\n                        charIndex = 0;\n                        typeNext();\n                    }\n                } else {\n                    // HTML 或 MathML → 整塊直接插入\n                    $element.append(node.cloneNode(true));\n                    nodeIndex++;\n                    typeNext();\n                }\n            }\n            typeNext();\n        });\n    }\n    // 播放音訊\n    function playAudio(src) {\n        return new Promise((resolve)=>{\n            const audio = new Audio(`audio/${src}`);\n            console.log(`Playing audio: audio/${src}`);\n            audio.onended = resolve;\n            audio.onerror = resolve; // 若音訊失敗也繼續流程\n            audio.play();\n        });\n    }\n    // 顯示一則訊息\n    async function showMessage(msg) {\n        const type = msg.speaker;\n        const $template = $(`.message-block.message-${type}`).first();\n        const $newMessage = $template.clone().hide();\n        const $textElement = $newMessage.find('p');\n        $textElement.text('');\n        $('.chat-messages').append($newMessage);\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        let typingPromise;\n        let audioPromise = Promise.resolve();\n        switch(type){\n            case 'UnvoicedNote':\n                $textElement.text(msg.text);\n                $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                typingPromise = new Promise((resolve)=>{\n                    $newMessage.fadeIn(300, resolve);\n                });\n                $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                break;\n            case 'Turi':\n                typingPromise = typeText($textElement, msg.text);\n                $newMessage.show();\n                $newMessage.find('.audio-icon').addClass('show');\n                $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                if (msg.audio) audioPromise = playAudio(msg.audio);\n                break;\n            case 'student':\n                $textElement.html(msg.text);\n                $newMessage.show();\n                $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                break;\n            default:\n                console.warn(`Unknown message type: ${type}`);\n                break;\n        }\n        await Promise.all([\n            typingPromise,\n            audioPromise\n        ]);\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        if (type === 'UnvoicedNote') await new Promise((resolve)=>setTimeout(resolve, 500));\n        else {\n            $newMessage.find('.audio-icon').addClass('pause');\n            await new Promise((resolve)=>setTimeout(resolve, 500));\n            $newMessage.find('.audio-icon').removeClass('show pause');\n        }\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        await new Promise((resolve)=>setTimeout(resolve, 1000));\n    }\n    // 顯示一組訊息（greeting、intro、feedback）\n    async function runLessonMessages(messages) {\n        if (!Array.isArray(messages) || messages.length === 0) return; // 沒東西就直接結束\n        for (const msg of messages){\n            if (msg.image) {\n                const $img = $('<img>', {\n                    class: 'concept-image',\n                    src: `images/${msg.image}`,\n                    alt: 'concept image'\n                });\n                $('.notes-section .card-content').empty();\n                $('.app-loader').removeClass('hidden').fadeIn(100);\n                setTimeout(()=>{\n                    $('.app-loader').fadeOut(200, ()=>{\n                        $('.notes-section .card-content').html($img).fadeIn(500);\n                    });\n                }, 300);\n            }\n            await showMessage(msg);\n        }\n    }\n    // 課程流程\n    async function runLesson(data) {\n        // 1. greeting\n        await runLessonMessages(data.greeting);\n        // 2. concepts\n        let currentConcept = 0;\n        async function runConcept(conceptIndex) {\n            const concept = data.concepts[conceptIndex];\n            // 3. intro\n            await runLessonMessages(concept.intro);\n            // 4. Choice\n            return new Promise((resolve)=>{\n                function showOptions(conceptIndex) {\n                    const concept = data.concepts[conceptIndex];\n                    // 4.1 Choice Button\n                    $('#choicePopup').empty();\n                    concept.options.forEach((option, i)=>{\n                        const $btn = $('<button>', {\n                            class: 'action-btn choice-btn',\n                            html: `<span class=\"choice\">${option.label}.</span>${option.text}`\n                        }).attr('data-concepts', conceptIndex).attr('data-options', i);\n                        if (option.isCorrect) $btn.data('correct', true);\n                        $('#choicePopup').append($btn);\n                        $('body').addClass('show-choice');\n                        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                    });\n                    // 5. Click\n                    $('.choice-btn').off('click').on('click', async function() {\n                        const c = $(this).data('concepts');\n                        const o = $(this).data('options');\n                        const option = data.concepts[c].options[o];\n                        // 5.1 hide choicePopup\n                        $('body').removeClass('show-choice');\n                        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                        // 5.2 play audio\n                        await playAudio('SFX_Select_01.mp3');\n                        // 5.3 show student Msg\n                        const studentMsg = [\n                            {\n                                speaker: 'student',\n                                text: `<span class=\"choice\">${option.label}.</span>${option.text}`\n                            }\n                        ];\n                        await runLessonMessages(studentMsg);\n                        // 5.4 feedback\n                        const turiFeedbacks = option.feedback.turi;\n                        const noteFeedbacks = option.feedback.note;\n                        let messagesToShow = [];\n                        if (Array.isArray(turiFeedbacks) && turiFeedbacks.length > 0) {\n                            const randomTuri = turiFeedbacks[Math.floor(Math.random() * turiFeedbacks.length)];\n                            messagesToShow.push(randomTuri);\n                        }\n                        if (Array.isArray(noteFeedbacks) && noteFeedbacks.length > 0) messagesToShow = messagesToShow.concat(noteFeedbacks);\n                        await runLessonMessages(messagesToShow);\n                        // 5.5 isCorrect\n                        if (option.isCorrect) {\n                            // ✅\n                            currentConcept++;\n                            if (currentConcept < data.concepts.length) {\n                                await runConcept(currentConcept);\n                                resolve();\n                            } else resolve();\n                        } else {\n                            // ❌\n                            await runLessonMessages(concept.reteach);\n                            await runLessonMessages(concept.redo);\n                            showOptions(conceptIndex);\n                            $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n                        }\n                    });\n                }\n                showOptions(conceptIndex);\n            });\n        }\n        // 2. concepts\n        await runConcept(currentConcept);\n        // 3. End\n        await runLessonMessages(data.close);\n    }\n    /* ------------------------------------------------ */ // 啟動流程\n    $('#startLessonBtn').on('click', function() {\n        $('#startPopup').hide();\n        setTimeout(()=>{\n            runLesson(lessonData); // ✅ 修正：傳整個 lessonData\n        }, 500);\n    });\n    /* ------------------------------------------------ */ // Action button interactions\n    $('.action-btn, .menu-btn').on('click', function() {\n        const buttonText = $(this).text().trim();\n        // Add visual feedback\n        $(this).addClass('active');\n        setTimeout(()=>{\n            $(this).removeClass('active');\n        }, 200);\n    });\n    // Handle window resize to maintain layout\n    $(window).on('resize', function() {\n        // Ensure proper height calculations on resize\n        const windowHeight = $(window).height();\n        const headerHeight = $('.header').outerHeight();\n        const remainingHeight = windowHeight - headerHeight;\n        $('.main-content').css('height', remainingHeight + 'px');\n    });\n    // Initial height calculation\n    $(window).trigger('resize');\n})();\n\n})();\n//# sourceMappingURL=main.js.map\n","(function () {\n\n  // Collapsible functionality\n  $('.card-header.clickable').on('click', function () {\n    const $card = $(this).closest('.collapsible');\n    const $content = $card.find('.card-content');\n    const $icon = $(this).find('.collapse-icon');\n\n    if ($card.hasClass('collapsed')) {\n      // Expand\n      $card.removeClass('collapsed').addClass('expanded');\n      $content.slideDown(300);\n      $icon.attr('data-lucide', 'chevron-up');\n    } else {\n      // Collapse\n      $card.removeClass('expanded').addClass('collapsed');\n      $content.slideUp(300);\n      $icon.attr('data-lucide', 'chevron-down');\n    }\n\n    // Recreate icons after changing data-lucide attribute\n    setTimeout(() => {\n        lucide.createIcons();\n      }, 100);\n  });\n\n  /* ------------------------------------------------ */\n\n  const lessonData = \n    {\n    \"greeting\": [\n      {\n        \"speaker\": \"Turi\",\n        \"text\": \"Welcome back. Today’s mission: spot linear functions fast — no tricks, just clean reasoning.\",\n        \"audio\": \"Greetings/M1_Greet_1.mp3\"\n      },\n      {\n        \"speaker\": \"Turi\",\n        \"text\": \"Think of it like speed-dating with graphs — you’ll know in seconds if it’s linear or not.\",\n        \"audio\": \"Greetings/M1_Greet_2.mp3\"\n      },\n      {\n        \"speaker\": \"UnvoicedNote\",\n        \"text\": \"In live mode, Turi makes sure students are ready before beginning.\"\n      },\n      {\n        \"speaker\": \"Turi\",\n        \"text\": \"You’ll see equations and graphs. Your job: decide if they’re linear and explain why.\",\n        \"audio\": \"Greetings/M1_Greet_3.mp3\"\n      },\n      {\n        \"speaker\": \"UnvoicedNote\",\n        \"text\": \"In live mode, you can answer by voice or typing.\",\n        \"audio\": \"Greetings/M1_Greet_4.mp3\"\n      }\n    ],\n    \"concepts\": [\n      {\n        \"id\": \"A\",\n        \"intro\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"First, the core idea: A line is linear if it has the <b>same slope everywhere</b>.\",\n            \"audio\": \"Concept A/M1_CA_1.mp3\",\n            \"image\": \"M1_CA.png\",\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": `In equations, that’s <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mi>m</mi><mi>x</mi><mo>+</mo><mi>b</mi></math></span> — one x, power of 1, nothing fancy. That one x tells us it’s a linear line.`,\n            \"audio\": \"Concept A/M1_CA_2.mp3\",\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"On a graph, that’s a straight line with no curves and no surprises.\",\n            \"audio\": \"Concept A/M1_CA_3.mp3\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Try one. Pick the linear equation — I’ll ask “why” after.\",\n            \"audio\": \"Concept A/M1_CA_4.mp3\"\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, Turi may ask follow-up questions to keep you thinking.\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Which equation is linear?\",\n            \"audio\": \"Concept A/M1_CS1_Prompt.mp3\"\n          }\n        ],\n        \"options\": [\n          {\n            \"label\": \"A\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mn>2</mn><mi>x</mi><mo>+</mo><mn>3</mn></math></span>`,\n            \"isCorrect\": true,\n            \"feedback\": {\n              \"turi\": [\n                { \"speaker\": \"Turi\",\n                  \"text\": \"Exactly. One x, power of 1. That’s linear.\",\n                  \"audio\": \"Choice 1 Responses/M1_CS1_A_C1.mp3\" \n                },\n                { \"speaker\": \"Turi\",\n                  \"text\": `Spot on. It fits <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mi>m</mi><mi>x</mi><mo>+</mo><mi>b</mi></math></span> perfectly.`,\n                  \"audio\": \"Choice 1 Responses/M1_CS1_A_C2.mp3\" }\n              ]\n            }\n          },\n          {\n            \"label\": \"B\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup><mo>−</mo><mn>4</mn></math></span>`,\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Not linear. <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup></math></span> curves the graph.`,\n                  \"audio\": \"Choice 1 Responses/M1_CS1_B_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Nope, quadratic means slope keeps changing.\",\n                  \"audio\": \"Choice 1 Responses/M1_CS1_B_W2.mp3\"\n                }\n              ],\n              \"note\": [\n                { \"speaker\": \"UnvoicedNote\",\n                  \"text\": \"In live mode, Turi can show helpful examples.\"\n                }\n              ]\n            }\n          },\n          {\n            \"label\": \"C\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mfrac><mn>1</mn><mi>x</mi></mfrac></math></span>`,\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Not quite. <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mfrac><mn>1</mn><mi>x</mi></mfrac></math></span> bends and never straightens.`,\n                  \"audio\": \"Choice 1 Responses/M1_CS1_C_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Nope, reciprocal graphs split and curve.\",\n                  \"audio\": \"Choice 1 Responses/M1_CS1_C_W2.mp3\"\n                }\n              ],\n              \"note\": [\n                {\n                  \"speaker\": \"UnvoicedNote\",\n                  \"text\": \"In live mode, Turi can show helpful examples.\"\n                }\n              ]\n            }\n          },\n          {\n            \"label\": \"D\",\n            \"text\": \"The one that looks nicest.\",\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Cute, but squinting doesn’t straighten curves.\",\n                  \"audio\": \"Choice 1 Responses/M1_CS1_D_J1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Funny, but the graph’s still curved.\",\n                  \"audio\": \"Choice 1 Responses/M1_CS1_D_J2.mp3\"\n                }\n              ],\n              \"note\": [\n                {\n                  \"speaker\": \"UnvoicedNote\",\n                  \"text\": \"In live mode, Turi sometimes uses humor to keep students engaged.\"\n                }\n              ]\n            }\n          },          \n        ],\n        \"reteach\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": `Linear means the same slope everywhere. If you see <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup></math></span> or <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mfrac><mn>1</mn><mi>x</mi></mfrac></math></span> , slope changes — not linear.`,\n            \"audio\": \"Choice 1 Responses/M1_CS1_Reteach.mp3\"\n          }\n        ],\n        \"redo\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Let’s try that again — which equation is linear?\",\n            \"audio\": \"Choice 1 Responses/M1_CS1_Redo.mp3\"\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, Turi may re-ask until the concept is clear.\"\n          }\n        ]\n      },\n      {\n        \"id\": \"B\",\n        \"intro\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"If you know a line is linear, two points are enough to determine the slope.\",\n            \"audio\": \"Concept B/M1_CB_1.mp3\",\n            \"image\": \"M1_CB.png\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Moreover, once you find the slope, you can write the whole equation if you know the y-intercept, or b value.\",\n            \"audio\": \"Concept B/M1_CB_2.mp3\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": `Look at the example question. The line is linear and it goes through points <b>(1,2)</b> and <b>(3,6)</b>. Slope is <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>m</mi><mo>=</mo><mfrac><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>6</mn><mo>−</mo><mn>2</mn></mrow></mstyle></mrow><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>3</mn><mo>−</mo><mn>1</mn></mrow></mstyle></mrow></mfrac><mo>=</mo><mfrac><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>4</mn></mrow></mstyle></mrow><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>2</mn></mrow></mstyle></mrow></mfrac><mo>=</mo><mn>2</mn></math></span>.`,\n            \"audio\": \"Concept B/M1_CB_3.mp3\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": `Since the line goes through (0, 0), y-intercept is 0. Therefore, the equation of the line is: <span><math xmlns=\\\"http://www.w3.org/1998/Math/MathML\\\"><mi>y</mi><mo>=</mo><mn>2</mn><mi>x</mi><mo>+</mo><mn>0</mn></math></span> or <span><math xmlns=\\\"http://www.w3.org/1998/Math/MathML\\\"><mi>y</mi><mo>=</mo><mn>2</mn><mi>x</mi></math></span>. Done.`,\n            \"audio\": \"Concept B/M1_CB_4.mp3\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Your turn: A straight line goes through points <b>(2,5)</b> and <b>(4,9)</b>. What’s the slope?\",\n            \"audio\": \"Concept B/M1_CB_Prompt.mp3\",\n            \"image\": \"M1_CB_Q.png\"\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, students can ask for more time or let Turi know they’re still working. Turi will wait, but repeated requests or prolonged idling will be flagged as possible off-task behavior.\"\n          }\n        ],\n        \"options\": [\n          {\n            \"label\": \"A\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>m</mi><mo>=</mo><mn>1</mn></math></span>`,\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Not quite. Slope is rise over run. `,\n                  \"audio\": \"Concept B/M1_CB_A_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Close, you calculated rise/run wrong. Rise is vertical and run is horizontal.\",\n                  \"audio\": \"Concept B/M1_CB_A_W2.mp3\"\n                }\n              ]\n            }\n          },\n          {\n            \"label\": \"B\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>m</mi><mo>=</mo><mn>2</mn></math></span>`,\n            \"isCorrect\": true,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Correct. Rise is 4, run is 2, slope is 2. `,\n                  \"audio\": \"Concept B/M1_CB_B_C1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Nice. Slope is <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mfrac><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>4</mn></mrow></mstyle></mrow><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>2</mn></mrow></mstyle></mrow></mfrac><mo>=</mo><mn>2</mn></math></span>.`,\n                  \"audio\": \"Concept B/M1_CB_B_C2.mp3\"\n                }\n              ],\n            }\n          },\n          {\n            \"label\": \"C\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>m</mi><mo>=</mo><mfrac><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>1</mn></mrow></mstyle></mrow><mrow><mpadded height=\"8.6pt\" depth=\"3pt\" width=\"0\"><mrow></mrow></mpadded><mstyle displaystyle=\"false\" scriptlevel=\"0\"><mrow><mn>2</mn></mrow></mstyle></mrow></mfrac></math></span>`,\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Not quite. You flipped rise/run.`,\n                  \"audio\": \"Concept B/M1_CB_C_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Nope, slope is rise over run, not the other way.\",\n                  \"audio\": \"Concept B/M1_CB_C_W2.mp3\"\n                }\n              ],\n            }\n          },\n          {\n            \"label\": \"D\",\n            \"text\": \"No slope, too tired.\",\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"note\": [\n                {\n                  \"speaker\": \"UnvoicedNote\",\n                  \"text\": \"In live mode, Turi may steer the student back on track if jokes continue.\"\n                }\n              ]\n            }\n          },\n        ],\n        \"redo\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Try again. What’s the slope for between points <b>(2,5)</b> and <b>(4,9)</b>?\",\n            \"audio\": \"Concept B/M1_CB_Redo.mp3\"\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, Turi guides students toward the right answer before moving on.\"\n          }\n        ]\n      },\n      {\n        \"id\": \"C\",\n        \"intro\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Last check: equations can be written in many forms — still linear if the slope stays constant.\",\n            \"audio\": \"Concept C/M1_CC_1.mp3\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": `For examples: <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>−</mo><mn>3</mn><mo>=</mo><mn>2</mn><mo stretchy=\"false\">(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy=\"false\">)</mo></math></span> or <math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>2</mn><mi>x</mi><mo>−</mo><mi>y</mi><mo>=</mo><mn>4</mn></math>. Different look, same slope rule.`,\n            \"audio\": \"Concept C/M1_CC_2.mp3\"\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, Turi can adjust the amount of algebra shown.\"\n          },\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Which of these is <b>not</b> linear?\",\n            \"audio\": \"Concept C/M1_CC_Prompt.mp3\",\n            \"image\": \"M1_CC_Q.png\",\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, students can ask for more time, and Turi will wait.\"\n          }\n        ],\n        \"options\": [\n          {\n            \"label\": \"A\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mo>−</mo><mn>5</mn><mi>x</mi><mo>+</mo><mn>7</mn></math></span>`,\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Nope, that is still linear. The slope is −5\",\n                  \"audio\": \"Concept C/M1_CC_A_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Not quite. It fits <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mi>m</mi><mi>x</mi><mo>+</mo><mi>b</mi></math></span>, so it’s linear.`,\n                  \"audio\": \"Concept C/M1_CC_A_W2.mp3\"\n                }\n              ]\n            }\n          },\n          {\n            \"label\": \"B\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mn>3</mn><mi>y</mi><mo>−</mo><mn>6</mn><mi>x</mi><mo>=</mo><mn>12</mn></math></span>`,\n            \"isCorrect\": false,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Nope, you can rearrange to <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mn>2</mn><mi>x</mi><mo>+</mo><mn>4</mn></math></span> , which is linear.`,\n                  \"audio\": \"Concept C/M1_CC_B_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Not quite. This is just in standard form, still linear.\",\n                  \"audio\": \"Concept C/M1_CC_B_W2.mp3\"\n                }\n              ],\n            }\n          },\n          {\n            \"label\": \"C\",\n            \"text\": `<span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><mi>y</mi><mo>=</mo><mn>4</mn><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup><mo>+</mo><mn>1</mn></math></span>`,\n            \"isCorrect\": true,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `NCorrect. <span><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><msup><mi>x</mi><mrow><mn>2</mn></mrow></msup></math></span> makes it quadratic, not linear.`,\n                  \"audio\": \"Concept C/M1_CC_C_C1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Exactly. Squared x makes it quadratic, so it’s out.\",\n                  \"audio\": \"Concept C/M1_CC_C_C2.mp3\"\n                }\n              ],\n            }\n          },\n        ],\n        \"reteach\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": `Linear means no exponents other than 1, no variables multiplied together. `,\n            \"audio\": \"Concept C/M1_CC_Reteach.mp3\"\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, Turi can handle unexpected answers appropriately.\"\n          }\n        ],\n        \"redo\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Try again — which of these is <b>not</b> linear?\",\n            \"audio\": \"Concept C/M1_CC_Redo.mp3\"\n          },\n          {\n            \"speaker\": \"UnvoicedNote\",\n            \"text\": \"In live mode, this re-ask would be open-ended, and Turi would guide the student until correct before moving on.\"\n          }\n        ]\n      },\n      {\n        \"id\": \"Quick Fire\",\n        \"intro\": [\n          {\n            \"speaker\": \"Turi\",\n            \"text\": \"Before we wrap — True or False: All linear equations have the same slope.\",\n            \"audio\": \"Quick Fire/M1_QF_Intro.mp3\"\n          },\n        ],\n        \"options\": [\n          {\n            \"label\": \"True\",\n            \"text\": '',\n            \"isCorrect\": true,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Nope, slope depends on the equation. Linear just means slope is constant within one equation.\",\n                  \"audio\": \"Quick Fire/M1_QF_A_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Not quite. Different lines can have different slopes. Constant slope only applies within a single equation.`,\n                  \"audio\": \"Quick Fire/M1_QF_A_W2.mp3\"\n                }\n              ]\n            }\n          },\n          {\n            \"label\": \"False\",\n            \"text\": '',\n            \"isCorrect\": true,\n            \"feedback\": {\n              \"turi\": [\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": \"Exactly. Slope varies between different lines, but stays constant within one.\",\n                  \"audio\": \"Quick Fire/M1_QF_A_W1.mp3\"\n                },\n                {\n                  \"speaker\": \"Turi\",\n                  \"text\": `Correct. Each linear equation has its own slope.`,\n                  \"audio\": \"Quick Fire/M1_QF_A_W2.mp3\"\n                }\n              ]\n            }\n          },\n        ],\n      },\n    ],\n    \"close\": [\n      {\n        \"speaker\": \"Turi\",\n        \"text\": \"And that’s it for today’s run. In live mode, we’d dive into tougher problems next. Keep that brain warmed up!\",\n        \"audio\": \"Quick Fire/M1_QF_Close.mp3\"\n      },\n      {\n        \"speaker\": \"UnvoicedNote\",\n        \"text\": \"In live mode, students answer in their own words. Turi adapts to their pace, keeps them engaged, and guides them back on track until the concept clicks\",\n      }\n    ]\n  }\n\n  /* ------------------------------------------------ */\n\n  const $chatContainer = $('.chat-messages');\n  // 打字效果：逐字顯示文字\n  function typeText($element, text, speed = 50) {\n    return new Promise(resolve => {\n      // 把字串丟給 DOMParser 解析成 DOM 結構\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(`<div>${text}</div>`, \"text/html\");\n      const nodes = Array.from(doc.body.firstChild.childNodes);\n\n      let nodeIndex = 0;\n      let charIndex = 0;\n\n      function typeNext() {\n        if (nodeIndex >= nodes.length) {\n          resolve();\n          return;\n        }\n\n        const node = nodes[nodeIndex];\n\n        if (node.nodeType === Node.TEXT_NODE) {\n          // 文字節點 → 逐字輸出\n          const chars = node.textContent;\n          if (charIndex < chars.length) {\n            $element.html($element.html() + chars.charAt(charIndex));\n            charIndex++;\n            setTimeout(typeNext, speed);\n          } else {\n            nodeIndex++;\n            charIndex = 0;\n            typeNext();\n          }\n        } else {\n          // HTML 或 MathML → 整塊直接插入\n          $element.append(node.cloneNode(true));\n          nodeIndex++;\n          typeNext();\n        }\n      }\n\n      typeNext();\n    });\n  }\n  \n\n  // 播放音訊\n  function playAudio(src) {\n    return new Promise(resolve => {\n      const audio = new Audio(`audio/${src}`);\n      console.log(`Playing audio: audio/${src}`);\n      audio.onended = resolve;\n      audio.onerror = resolve; // 若音訊失敗也繼續流程\n      audio.play();\n    });\n  }\n\n  // 顯示一則訊息\n  async function showMessage(msg) {\n    const type = msg.speaker;\n    const $template = $(`.message-block.message-${type}`).first();\n    const $newMessage = $template.clone().hide();\n    const $textElement = $newMessage.find('p');\n\n    $textElement.text('');\n    $('.chat-messages').append($newMessage);\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    let typingPromise;\n    let audioPromise = Promise.resolve();\n\n    switch (type) {\n      case 'UnvoicedNote':\n        $textElement.text(msg.text);\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        typingPromise = new Promise(resolve => {\n          $newMessage.fadeIn(300, resolve);\n        });\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        break;\n\n      case 'Turi':\n        typingPromise = typeText($textElement, msg.text);  \n        $newMessage.show();\n        $newMessage.find('.audio-icon').addClass('show');\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        if (msg.audio) {\n          audioPromise = playAudio(msg.audio);\n        }\n        break;\n\n      case 'student':\n        $textElement.html(msg.text);\n        $newMessage.show();\n        $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n        break;\n\n      default:\n        console.warn(`Unknown message type: ${type}`);\n        break;\n    }\n\n    await Promise.all([typingPromise, audioPromise]);\n\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    if (type === 'UnvoicedNote') {\n      await new Promise(resolve => setTimeout(resolve, 500));\n    } else {\n      $newMessage.find('.audio-icon').addClass('pause');\n      await new Promise(resolve => setTimeout(resolve, 500));\n      $newMessage.find('.audio-icon').removeClass('show pause');\n    }\n\n    $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n    await new Promise(resolve => setTimeout(resolve, 1000));\n  }\n\n  // 顯示一組訊息（greeting、intro、feedback）\n  async function runLessonMessages(messages) {\n    if (!Array.isArray(messages) || messages.length === 0) {\n      return; // 沒東西就直接結束\n    }\n    for (const msg of messages) {\n      if (msg.image) {\n        const $img = $('<img>', {\n          class: 'concept-image',\n          src: `images/${msg.image}`,\n          alt: 'concept image'\n        });\n        $('.notes-section .card-content').empty();\n        $('.app-loader').removeClass('hidden').fadeIn(100);\n        setTimeout(() => {\n          $('.app-loader').fadeOut(200, () => {\n            $('.notes-section .card-content').html($img).fadeIn(500);\n          });\n        }, 300);\n      }\n      await showMessage(msg);\n    }\n  }  \n\n  // 課程流程\n\n\n\n  async function runLesson(data) {\n    // 1. greeting\n    await runLessonMessages(data.greeting);\n\n    // 2. concepts\n    let currentConcept = 0;\n    async function runConcept(conceptIndex) {\n      const concept = data.concepts[conceptIndex];\n      // 3. intro\n      await runLessonMessages(concept.intro);\n\n      // 4. Choice\n      return new Promise(resolve => {\n        function showOptions(conceptIndex) {\n          const concept = data.concepts[conceptIndex];\n\n          // 4.1 Choice Button\n          $('#choicePopup').empty();\n          concept.options.forEach((option, i) => {\n            const $btn = $('<button>', {\n              class: 'action-btn choice-btn',\n              html: `<span class=\"choice\">${option.label}.</span>${option.text}`\n            }).attr('data-concepts', conceptIndex)\n              .attr('data-options', i);\n            if (option.isCorrect) {\n              $btn.data('correct', true);\n            }\n            $('#choicePopup').append($btn);\n            $('body').addClass('show-choice');\n            $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n          });\n\n          // 5. Click\n          $('.choice-btn').off('click').on('click', async function () {\n            const c = $(this).data('concepts');\n            const o = $(this).data('options');\n            const option = data.concepts[c].options[o];\n\n            // 5.1 hide choicePopup\n            $('body').removeClass('show-choice');\n            $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n\n            // 5.2 play audio\n            await playAudio('SFX_Select_01.mp3');\n\n            // 5.3 show student Msg\n            const studentMsg = [{\n              speaker: 'student',\n              text: `<span class=\"choice\">${option.label}.</span>${option.text}`,\n            }];\n            await runLessonMessages(studentMsg);\n\n            // 5.4 feedback\n            const turiFeedbacks = option.feedback.turi;\n            const noteFeedbacks = option.feedback.note;\n\n            let messagesToShow = [];\n            if (Array.isArray(turiFeedbacks) && turiFeedbacks.length > 0) {\n              const randomTuri = turiFeedbacks[Math.floor(Math.random() * turiFeedbacks.length)];\n              messagesToShow.push(randomTuri);\n            }\n            if (Array.isArray(noteFeedbacks) && noteFeedbacks.length > 0) {\n              messagesToShow = messagesToShow.concat(noteFeedbacks);\n            }\n            await runLessonMessages(messagesToShow);\n\n            // 5.5 isCorrect\n            if (option.isCorrect) {\n              // ✅\n              currentConcept++;\n              if (currentConcept < data.concepts.length) {\n                await runConcept(currentConcept);\n                resolve();\n              } else {\n                resolve();\n              }\n            } else {\n              // ❌\n              await runLessonMessages(concept.reteach);\n              await runLessonMessages(concept.redo);\n              showOptions(conceptIndex);\n              $chatContainer.scrollTop($chatContainer[0].scrollHeight);\n            }\n          });\n        }\n        showOptions(conceptIndex);\n      });\n    }\n\n    // 2. concepts\n    await runConcept(currentConcept);\n\n    // 3. End\n    await runLessonMessages(data.close);\n  }\n\n  /* ------------------------------------------------ */\n\n  // 啟動流程\n  $('#startLessonBtn').on('click', function () {\n    $('#startPopup').hide();\n    setTimeout(() => {\n      runLesson(lessonData); // ✅ 修正：傳整個 lessonData\n    }, 500);\n  });\n    \n  /* ------------------------------------------------ */\n\n  // Action button interactions\n  $('.action-btn, .menu-btn').on('click', function () {\n    const buttonText = $(this).text().trim();\n    // Add visual feedback\n    $(this).addClass('active');\n    setTimeout(() => {\n      $(this).removeClass('active');\n    }, 200);\n  });\n\n  // Handle window resize to maintain layout\n  $(window).on('resize', function () {\n    // Ensure proper height calculations on resize\n    const windowHeight = $(window).height();\n    const headerHeight = $('.header').outerHeight();\n    const remainingHeight = windowHeight - headerHeight;\n    $('.main-content').css('height', remainingHeight + 'px');\n  });\n\n  // Initial height calculation\n  $(window).trigger('resize');\n})();"],"names":["$","on","$card","closest","$content","find","$icon","hasClass","removeClass","addClass","slideDown","attr","slideUp","setTimeout","lucide","createIcons","lessonData","$chatContainer","playAudio","src","Promise","resolve","audio","Audio","console","log","onended","onerror","play","showMessage","msg","typingPromise","type","speaker","$newMessage","$template","first","clone","hide","$textElement","text","append","scrollTop","scrollHeight","audioPromise","fadeIn","typeText","$element","speed","nodes","Array","from","doc","parser","DOMParser","parseFromString","body","firstChild","childNodes","nodeIndex","charIndex","typeNext","length","node","nodeType","Node","TEXT_NODE","chars","textContent","html","charAt","cloneNode","show","warn","all","runLessonMessages","messages","isArray","image","$img","class","alt","empty","fadeOut","runLesson","data","greeting","currentConcept","runConcept","conceptIndex","concept","concepts","intro","showOptions","options","forEach","option","i","$btn","label","isCorrect","off","c","o","studentMsg","turiFeedbacks","feedback","turi","noteFeedbacks","note","messagesToShow","randomTuri","Math","floor","random","push","concat","reteach","redo","close","trim","window","windowHeight","height","headerHeight","outerHeight","css","remainingHeight","trigger"],"version":3,"file":"main.js.map"}